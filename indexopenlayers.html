<!doctype html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="https://openlayers.org/en/v4.6.5/css/ol.css" type="text/css">
    <style>
      .map {
        height: 100%;
        width: 100%;
      }
    </style>
    <script src="https://openlayers.org/en/v4.6.5/build/ol.js" type="text/javascript"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <title>OpenLayers example</title>
  </head>
  <body>
    <h2>GPP</h2>
    <div id="map" class="map"></div>
    <script type="text/javascript">
    var features = [];


      $.ajax({
    url: 'https://172.16.29.41:8080/geoserver/geluidregister/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=geluidregister:c207_geluidproductieplafonds&maxFeatures=61000&outputFormat=application%2Fjson',
    dataType: 'json',
    async: false,
    success: function(json1) {
        $.each(json1, function (key, data) {
            if (key == 'features') {
                $.each(data, function (k, v) {
                    if (v.type=='Feature') {
                        if (v.geometry.coordinates.length>1) {
                            features[k] = new ol.Feature(new ol.geom.Point(v.geometry.coordinates));
                        }
                    }
                });
            }
        });
    }
});
/*
      var layers = [
              new ol.layer.Tile({
                source: new ol.source.OSM()
              }),
              new ol.layer.Image({
                extent: [-13884991, 2870341, -7455066, 6338219],
                source: new ol.source.ImageWMS({
                  url: 'http://172.16.29.41:8080/geoserver/geluidregister/wms?service=WMS&version=1.1.0&request=GetMap&layers=geluidregister:c207_geluidproductieplafonds&styles=&bbox=394143.1875,6578046.5,804491.3125,7063132.5&width=649&height=768&srs=EPSG:900913&format=application/openlayers',
                  params: {'LAYERS': 'geluidregister:c207_geluidproductieplafonds'},
                  ratio: 1,
                  serverType: 'geoserver'
                })
              })
            ];*/

        /*    var layers = [
              new ol.layer.Tile({
                source: new ol.source.OSM()
              }),
              new ol.layer.Vector({
                    title: 'added Layer',
                    renderMode: 'image',
                    source: new ol.source.Vector({
                       url: 'http://172.16.29.41:8080/geoserver/geluidregister/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=geluidregister:c207_geluidproductieplafonds&maxFeatures=61000&outputFormat=application%2Fjson',
                       format: new ol.format.GeoJSON()
                    })
                })
            ];*/
            var source = new ol.source.Vector({
                features: features
            });

            var clusterSource = new ol.source.Cluster({
                distance: 12,
                source: source
            });

            var raster = new ol.layer.Tile({
              source: new ol.source.OSM({
              })
            });

            var styleCache = {};
            var clusters = new ol.layer.Vector({
                    source: clusterSource,
                    style: function(feature) {
                      var size = feature.get('features').length;
                      var style = styleCache[size];
                      if (!style) {
                        style = new ol.style.Style({
                          image: new ol.style.Circle({
                            radius: 10,
                            stroke: new ol.style.Stroke({
                              color: '#fff'
                            }),
                            fill: new ol.style.Fill({
                              color: '#3399CC'
                            })
                          }),
                          text: new ol.style.Text({
                            text: size.toString(),
                            fill: new ol.style.Fill({
                              color: '#fff'
                            })
                          })
                        });
                        styleCache[size] = style;
                      }
                      return style;
                    }
                  });

      var map = new ol.Map({
        target: 'map',
        layers: [raster, clusters],
        view: new ol.View({
          center: [550957.098763, 6805777.828659],
          zoom: 7,
          minZoom: 7,
          maxZoom: 17,
        })
      });
    </script>
  </body>
</html>
